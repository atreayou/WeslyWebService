<!-- <DOCTYPE! html>
<html>
	<head>
		<title>Wesley Web Service</title>
	</head>
	<body> -->
		<div align="center">
			<h1>Sonus JS</h1>
			<h3>Web Service Demo</h3>
			<button id="record">Record</button>
			<a id="save" href="#">Save wav</a>
		</div>
		<br>
		<!-- <div id="progress" align="center">0% complete</div> -->
		<div id="box" style="background: #eee; font-size: 26px; width: 400px; height: 300px;line-height: 300px; margin: 0 auto; text-align: center;">
			Connecting...
		</div>

		<div id="result" align="center"><div>

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script> 
		<script type="text/javascript" src="js/recorder.js"></script>
		<script type="text/javascript" src="js/audio.js"></script>
		<script type="text/javascript" src="js/binary.js"></script>
		<script type="text/javascript">
			var client = new BinaryClient('ws://localhost:3000');
			
			// Wait for connection to BinaryJS server
			client.on('open', function(){
				var box = $('#box');
				box.on('dragenter', doNothing);
				box.on('dragover', doNothing);
				box.text('Drag files here');
				box.on('drop', function(e){
					e.originalEvent.preventDefault();
					var file = e.originalEvent.dataTransfer.files[0];
					
					// Add to list of uploaded files
					$('<div align="center"></div>').append($('<a></a>').text(file.name).prop('href', '/'+file.name)).appendTo('body');
					
					// `client.send` is a helper function that creates a stream with the 
					// given metadata, and then chunks up and streams the data.
					var stream = client.send(file, {name: file.name, size: file.size});
					
					// Print progress
					// var tx = 0;
					// stream.on('data', function(data){
					// 	console.log('stream data');
					// 	$('#progress').text(Math.round(tx+=data.rx*100) + '% complete');
					// });

					stream.on('data', function(data) {
						$.ajax({url: '/api/audio'})
						.then(function(data) {
							console.log('woo');
							console.log(data);
							$('#result').html('<h2>Result: ' + data + '</h2>');
						});
					});

				}); 
			});
			
			// Deal with DOM quirks
			function doNothing (e){
				e.preventDefault();
				e.stopPropagation();
			}

			var recording = false;
			$('#record').on('click', function() {
				toggleRecording(this);
				recording = !recording;
				if (recording) {
					$(this).html('Stop');
				} else {
					$(this).html('Record');
				}
			});
		</script>
<!-- 	</body>
</html> -->
